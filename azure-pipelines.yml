strategy:
  matrix:
    1ESWindows2022Python3.7:
      Pool: "azsdk-pool-mms-win-2022-general"
      OSVmImage: "windows-2022"
      PythonVersion: "3.7"
    1ESWindows2022Python3.8:
      Pool: "azsdk-pool-mms-win-2022-general"
      OSVmImage: "windows-2022"
      PythonVersion: "3.8"
    1ESWindows2022Python3.9:
      Pool: "azsdk-pool-mms-win-2022-general"
      OSVmImage: "windows-2022"
      PythonVersion: "3.9"
    1ESWindows2022Python3.10:
      Pool: "azsdk-pool-mms-win-2022-general"
      OSVmImage: "windows-2022"
      PythonVersion: "3.10"
    1ESWindows2022Python3.11:
      Pool: "azsdk-pool-mms-win-2022-general"
      OSVmImage: "windows-2022"
      PythonVersion: "3.11"
    1ESWindows2022LatestPython3.7:
      Pool: "azsdk-pool-mms-win-2022-latest"
      OSVmImage: "windows-2022-latest"
      PythonVersion: "3.7"
    1ESWindows2022LatestPython3.8:
      Pool: "azsdk-pool-mms-win-2022-latest"
      OSVmImage: "windows-2022-latest"
      PythonVersion: "3.8"
    1ESWindows2022LatestPython3.9:
      Pool: "azsdk-pool-mms-win-2022-latest"
      OSVmImage: "windows-2022-latest"
      PythonVersion: "3.9"
    1ESWindows2022LatestPython3.10:
      Pool: "azsdk-pool-mms-win-2022-latest"
      OSVmImage: "windows-2022-latest"
      PythonVersion: "3.10"
    1ESWindows2022LatestPython3.11:
      Pool: "azsdk-pool-mms-win-2022-latest"
      OSVmImage: "windows-2022-latest"
      PythonVersion: "3.11"
    DevOpsWindows2022Python3.7:
      Pool: Azure Pipelines
      OSVmImage: "windows-2022"
      PythonVersion: "3.7"
    DevOpsWindows2022Python3.8:
      Pool: Azure Pipelines
      OSVmImage: "windows-2022"
      PythonVersion: "3.8"
    DevOpsWindows2022Python3.9:
      Pool: Azure Pipelines
      OSVmImage: "windows-2022"
      PythonVersion: "3.9"
    DevOpsWindows2022Python3.10:
      Pool: Azure Pipelines
      OSVmImage: "windows-2022"
      PythonVersion: "3.10"
    DevOpsWindows2022Python3.11:
      Pool: Azure Pipelines
      OSVmImage: "windows-2022"
      PythonVersion: "3.11"

pool:
  name: $(Pool)
  vmImage: $(OSVmImage)

variables:
  skipComponentGovernanceDetection: true
  NugetSecurityAnalysisWarningLevel: 'none'

steps:
  - task: UsePythonVersion@0
    displayName: "Use Python $(PythonVersion)"
    inputs:
      versionSpec: $(PythonVersion)

  - script: |
      python --version
      pip --version

      pip install packaging==20.4

      pip list
      pip freeze

      python -c "from packaging.version import Version, InvalidVersion"
    displayName: Test pip and python
    condition: succeededOrFailed()

  - script: |
      python --version
      python -m pip --version

      python -m pip install packaging==20.4

      python -m pip list
      python -m pip freeze

      python -c "from packaging.version import Version, InvalidVersion"
    displayName: Test pip and python
    condition: succeededOrFailed()
